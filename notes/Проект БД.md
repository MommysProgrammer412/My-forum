# Проектирование базы данных

**Сущности:**
Пользователь, уведомления, посты (ретвиты), хэштэги, лайки, комментарии, жалобы, токен восстановления пароля, файлы.

>Выпиши все сущности (объекты), с которыми работает система
>Сущность — это то, что можно посчитать и у чего есть свойства.
>Например: пользователь, пост, комментарий, хэштег, уведомление.

**Атрибуты сущностей**
- Пользователь: имя, пол, день и месяц рождения, почта, пароль, аватарка, статус, user_id, blocked_status.
- Посты: текст, дата и время, author_id, post_id, is_blocked, block_reason, is_pinned.
- Комментарии: текст, дата и время, author_id, is_blocked, block_reason, comment_id.
- Жалобы: причина, статус, дата и время, report_id.
- Лайки: дата и время, like_id.
- Хэштэги: название, slug, hashtag_id, is_blocked, block_reason.
- Уведомления: тип события, статус прочтения, дата и время создания, object_id, object_type, notification_id.
- Токен восстановления пароля:  user_id, token_hash, expires_at.
- Файл: file_id, file_hash, file_path, size, file_type, uploaded_at, original_name, author_id.

>Для каждой сущности определи её атрибуты (поля)
>Атрибут (деталь действия) — это характеристика сущности.
>Например, у пользователя: имя, почта, дата рождения, пол, аватарка, статус, дата регистрации
>
>`Сущность не может быть атрибутом другой сущности. И связи (кто, кого) тоже`

**Определение связей между сущностями**
- Пользователь → `ForeignKey` → к постам/лайкам/комментариям/заблокированным профилям.
- Пост → `ForeignKey` → к комментариям/лайкам/хэштэгам/вложение поста/жалобам.
- Хэштэги → `ManyToManyField` → к постам.
- Лайки → `ForeignKey` → к посту/комментарию.
- Комментарии → `ForeignKey` → к посту.
- Жалобы → `ForeignKey` → к посту/комментарию.
- Уведомления → `ForeignKey` → к лайку/комментарию/к пользователям.
- Файлы → `ManyToManyField` → к постам.
- Токен восстановления пароля → `ForeignKey` → к пользователям.

>В базе данных принято называть тип связи по направлению от родителя к детям
>
>Один ко многим и Многие к одному → `ForeignKey`
>Многие ко многим → `ManyToManyField`
>Один к одному → `OneToOneField`

**Таблицы сущностей и их поля**
- Пост будет иметь отдельную таблицу (Post) с полями: retweet_of (id родительского поста | ForeignKey), text (текст ретвита | TextField), created_at (время и дата создания | DateTimeField), author (id автора | ForeignKey), is_blocked (статус скрытия | BooleanField), block_reason (причина скрытия | CharField), is_pinned (статус закрепления | BooleanField);
- Ретвит это пост (таблица Post) со ссылкой на ID родителя (поле retweet_of): если оно заполнено это `ретвит`, если еще заполнено поле текст (text) это `цитата`;
- Комментарий это модель (таблица Comment) отличающаяся от поста, у которой есть поля: post (id поста коммента | ForeignKey), author (id автора | ForeignKey), text (текст коммента | TextField), created_at (время и дата создания | DateTimeField), is_blocked (статус скрытия | BooleanField), block_reason (причина скрытия | CharField);
- Токен восстановления пароля будут иметь отдельную таблицу (PasswordResetToken) с полями: user (id юзера | ForeignKey), token_hash (хэш токена | CharField), expires_at (хранение времени жизни токена в формате Timestamp | DateTimeField). При смене пароля надо удалять запись токена из этой таблицы сразу после использования;
- Уведомления будут иметь отдельную таблицу (Notification) с полями: user (id юзера | ForeignKey), author (кто вызвал | ForeignKey), verb (тип действия | CharField), target (с чем взаимодействовал author | CharField), created_at (время и дата создания | DateTimeField), is_read (статус прочтения | BooleanField), object (id объекта с которым взаимодействовал author | ForeignKey), object_type (тип объекта с которым взаимодействовал author | CharField);
- Лайки будут иметь две таблицы (PostLike, CommentLike) и поля: created_at (время и дата создания | DateTimeField), author (id автора лайка | ForeignKey), post/comment (id лайкнутокго поста или коммента | ForeignKey);
- Хэштэги будут иметь отдельную таблицу (Hashtag) и таблицу связей (PostHashtag). С полями для Hashtag: name (имя | CharField), slug (слаг | SlugField), is_blocked (статус скрытия | BooleanField), block_reason (причина скрытия | CharField). С полями для PostHashtag: post (id поста | ForeignKey), hashtag (id хэштэга | ForeignKey);
- Подписчики и подписки это не таблицы, а результат связи между пользователями (Many-to-Many), через промежуточную таблицу (Follow) с полями: follower (id подписчика | ForeignKey), leader (id подписки | ForeignKey);
- Жалобы будут иметь две таблицы (PostReport, CommentReport) с полями: reason (причина жалобы | CharField), report_status (статус жалобы | CharField), created_at (время и дата создания | DateTimeField), post/comment (id поста или коммента | ForeignKey), user (id жалуегощася юзера | ForeignKey);
- Вложения будут связующей таблицей (Attachment) между постами и файлами с полями: post (id поста | ForeignKey), file (id файла | ForeignKey);
- Пользователь будет иметь отдельную таблицу (User) с полями: username (имя юзера | CharField), birthday (день и месяц рождения | DateField), status (статус | TextField), sex (пол | CharField), email (эл. почта | EmailField), password_hash (хэш пароля | CharField), avatar (аватарка | ImageField), blocked_status (статус блокировки или скрытия | CharField); 
- Черный спискок (Block) будет промежуточной таблицей с полями: blocker (id кто заблокал | ForeignKey), blocked (id кого заблокали | ForeignKey), created_at (время и дата блока | DateTimeField);
- Файлы будут иметь отдельную таблицу (file) с полями: file_hash (хэш файла | CharField), file_path (путь к файлу | FileField), size (размер файла | PositiveIntegerField), file_type (тип файла | CharField), uploaded_at (время и дата загрузки | DateTimeField), original_name (оригинальное имя | CharField), author (id автора | ForeignKey);

>1. Текстовые (Строки)
>    CharField(max_length=...): Для коротких строк (заголовки, имена, теги). Обязателен атрибут max_length.
>    TextField(): Для длинных текстов (тело поста, комментарий, биография).
>    SlugField(): Короткая метка (латиница, цифры, дефисы) для красивых URL (например, kak-vybrat-pk).
>    EmailField(): Тот же CharField, но со встроенной проверкой на формат почты.
>
>2. Числовые
>    IntegerField(): Обычное целое число (счетчик лайков, возраст).
>    PositiveIntegerField(): Только положительные числа (от 0).
>    DecimalField(max_digits=..., decimal_places=...): Для денег и точных расчетов.
>    FloatField(): Для научных данных, где допустима небольшая погрешность.
>
>3. Дата и Время
>    DateTimeField(): Дата + время (время публикации). Используй auto_now_add=True для фиксации времени создания.
>    DateField(): Только дата (день рождения).
>
>4. Логика и Файлы
>    BooleanField(default=...): Флаг (True/False). Например, is_closed для темы или is_active.
>    FileField(upload_to='...'): Путь к загруженному файлу.
>    ImageField(...): То же самое, но проверяет, что файл — картинка.
>
>5. Специальные
>    JSONField(): Если нужно хранить словари или списки прямо в одной ячейке (настройки, метаданные).
>    UUIDField(): Для уникальных длинных ID (вместо цифр 1, 2, 3).
>
>6. Связи (Relations)
>    ForeignKey(Model, on_delete=...): Связь «многие к одному» (много постов у одного автора).
>    ManyToManyField(Model): Связь «многие ко многим» (у поста много тегов, у тега много постов).
>    OneToOneField(Model, ...): Строго 1 к 1 (Профиль пользователя расширяет таблицу User).
>
>Важный нюанс: Для любого поля можно добавить null=True (разрешить пустоту в БД) и blank=True (разрешить пустоту в формах на сайте).

**ER-диаграмма**
[User] ──< [Post]/[PostLike]/[CommentLike]/[Comment] 
[Post] ──< [Comment]/[PostLike]/[Hashtag]/[Attachment]/[PostReport]
[Comment] >── [Post]
[PasswordResetToken] >── [User]
[Notification] >── [User]/[Post]/[Comment]/[PostLike]/[CommentLike]/[Follow]
[PostLike] >── [Post]
[CommentLike] >── [Comment]
[Hashtag] >── [PostHashtag] ──< [Post]  <!-- Django сам создаст, в модели: hashtags = models.ManyToManyField(Hashtag, blank=True) -->
[User] >── [Follow] ──< [User]  <!-- Django сам создаст, в модели: follow = models.ManyToManyField('self', symmetrical=False, related_name='followers', through='Follow') -->
[PostReport] >── [Post]
[CommentReport] >── [Comment]
[post] ──< [attachment] >── [file]  <!-- Django сам создаст, в модели: files = models.ManyToManyField(File) -->
[User] >── [Block] ──< [User]   <!-- Django сам создаст, в модели: block = models.ManyToManyField('self', symmetrical=False, related_name='blocked_by', through='Block') -->

>### Как их строить (текстовая визуализация):
>Программисты рисуют их из трех элементов:
>
>- Прямоугольники — это ваши Сущности (Таблицы).
>- Линии — это связи между ними.
>- Символы на концах линий — показывают тип связи:
>Линия со стрелочкой/вилкой — сторона «Много».
>Простая линия или "1" — сторона «Один».